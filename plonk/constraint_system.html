<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Circuit API - docs</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="../favicon.svg">
                        <link rel="shortcut icon" href="../favicon.png">
                <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
                <link rel="stylesheet" href="../css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="../fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> FFT Library</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../fft/benchmarks.html"><strong aria-hidden="true">2.1.</strong> Benchmarks</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.</strong> Plonk</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../plonk/recap.html"><strong aria-hidden="true">3.1.</strong> Recap</a></li><li class="chapter-item expanded "><a href="../plonk/protocol.html"><strong aria-hidden="true">3.2.</strong> Protocol</a></li><li class="chapter-item expanded "><a href="../plonk/implementation.html"><strong aria-hidden="true">3.3.</strong> Implementation</a></li><li class="chapter-item expanded "><a href="../plonk/constraint_system.html" class="active"><strong aria-hidden="true">3.4.</strong> Circuit API</a></li></ol></li><li class="chapter-item expanded "><a href="../starks/starks.html"><strong aria-hidden="true">4.</strong> STARKs</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../starks/recap.html"><strong aria-hidden="true">4.1.</strong> Recap</a></li><li class="chapter-item expanded "><a href="../starks/protocol_overview.html"><strong aria-hidden="true">4.2.</strong> Protocol overview</a></li><li class="chapter-item expanded "><a href="../starks/protocol.html"><strong aria-hidden="true">4.3.</strong> Protocol</a></li><li class="chapter-item expanded "><a href="../starks/implementation.html"><strong aria-hidden="true">4.4.</strong> Implementation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../starks/api.html"><strong aria-hidden="true">4.4.1.</strong> High Level API</a></li><li class="chapter-item expanded "><a href="../starks/under_the_hood.html"><strong aria-hidden="true">4.4.2.</strong> Under the hood</a></li></ol></li><li class="chapter-item expanded "><a href="../starks/stone_prover/introduction.html"><strong aria-hidden="true">4.5.</strong> Stone prover</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../starks/stone_prover/trace_plain_layout.html"><strong aria-hidden="true">4.5.1.</strong> Plain layout trace description</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../starks/cairo.html"><strong aria-hidden="true">5.</strong> Cairo</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../starks/cairo_trace_succinct.html"><strong aria-hidden="true">5.1.</strong> Trace Formal Description</a></li><li class="chapter-item expanded "><a href="../starks/cairo_trace_descriptive.html"><strong aria-hidden="true">5.2.</strong> Trace Detailed Description</a></li><li class="chapter-item expanded "><a href="../starks/cairo_rap.html"><strong aria-hidden="true">5.3.</strong> RAP</a></li><li class="chapter-item expanded "><a href="../starks/virtual_cols.html"><strong aria-hidden="true">5.4.</strong> Virtual Columns</a></li><li class="chapter-item expanded "><a href="../starks/builtins.html"><strong aria-hidden="true">5.5.</strong> Built-ins</a></li><li class="chapter-item expanded "><a href="../starks/cairo_cli.html"><strong aria-hidden="true">5.6.</strong> CLI</a></li></ol></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">docs</h1>

                    <div class="right-buttons">
                                                <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="circuit-api"><a class="header" href="#circuit-api">Circuit API</a></h1>
<p>In this section, we'll discuss how to build your own constraint system to prove the execution of a particular program.</p>
<h2 id="simple-example"><a class="header" href="#simple-example">Simple Example</a></h2>
<p>Let's take the following simple program as an example. We have two public inputs: <code>x</code> and <code>y</code>. We want to prove to a verifier that we know a private input <code>e</code> such that <code>x * e = y</code>. You can achieve this by building the following constraint system:</p>
<pre><pre class="playground"><code class="language-rust">use lambdaworks_plonk::constraint_system::ConstraintSystem;
use lambdaworks_math::elliptic_curve::short_weierstrass::curves::bls12_381::default_types::FrField;

fn main() {
    let system = &amp;mut ConstraintSystem::&lt;FrField&gt;::new();
    let x = system.new_public_input();
    let y = system.new_public_input();
    let e = system.new_variable();

    let z = system.mul(&amp;x, &amp;e);
    
    // This constraint system asserts that x * e == y
    system.assert_eq(&amp;y, &amp;z);
}
</code></pre></pre>
<p>This code creates a constraint system over the field of the BLS12381 curve. Then, it creates three variables: two public inputs <code>x</code> and <code>y</code>, and a private variable <code>e</code>. Note that every variable is private except for the public inputs. Finally, it adds the constraints that represent a multiplication and an assertion.</p>
<p>Before generating proofs for this system, we need to run a setup and obtain a verifying key:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let common = CommonPreprocessedInput::from_constraint_system(&amp;system, &amp;ORDER_R_MINUS_1_ROOT_UNITY);
let srs = test_srs(common.n);
let kzg = KZG::new(srs); // The commitment scheme for plonk.
let vk = setup(&amp;common, &amp;kzg);
<span class="boring">}
</span></code></pre></pre>
<p>Now we can generate proofs for our system. We just need to specify the public inputs and obtain a witness that is a solution for our constraint system:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let inputs = HashMap::from([(x, FieldElement::from(4)), (e, FieldElement::from(3))]);
let assignments = system.solve(inputs).unwrap();
let witness = Witness::new(assignments, &amp;system);
<span class="boring">}
</span></code></pre></pre>
<p>Once you have all these ingredients, you can call the prover:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let public_inputs = system.public_input_values(&amp;assignments);
let prover = Prover::new(kzg.clone(), TestRandomFieldGenerator {});
let proof = prover.prove(&amp;witness, &amp;public_inputs, &amp;common, &amp;vk);
<span class="boring">}
</span></code></pre></pre>
<p>and verify:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let verifier = Verifier::new(kzg);
assert!(verifier.verify(&amp;proof, &amp;public_inputs, &amp;common, &amp;vk));
<span class="boring">}
</span></code></pre></pre>
<h2 id="building-complex-systems"><a class="header" href="#building-complex-systems">Building Complex Systems</a></h2>
<p>Some operations are common, and it makes sense to wrap the set of constraints that do these operations in a function and use it several times. Lambdaworks comes with a collection of functions to help you build your own constraint systems, such as conditionals, inverses, and hash functions.</p>
<p>However, if you have an operation that does not come with Lambdaworks, you can easily extend Lambdaworks functionality. Suppose that the exponentiation operation is something common in your program. You can write the <a href="https://en.wikipedia.org/wiki/Exponentiation_by_squaring">square and multiply</a> algorithm and put it inside a function:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub fn pow(
    system: &amp;mut ConstraintSystem&lt;FrField&gt;,
    base: Variable,
    exponent: Variable,
) -&gt; Variable {
    let exponent_bits = system.new_u32(&amp;exponent);
    let mut result = system.new_constant(FieldElement::one());

    for i in 0..32 {
        if i != 0 {
            result = system.mul(&amp;result, &amp;result);
        }
        let result_times_base = system.mul(&amp;result, &amp;base);
        result = system.if_else(&amp;exponent_bits[i], &amp;result_times_base, &amp;result);
    }
    result
}
<span class="boring">}
</span></code></pre></pre>
<p>This function can then be used to modify our simple program from the previous section. The following circuit checks that the prover knows <code>e</code> such that <code>pow(x, e) = y</code>:</p>
<pre><pre class="playground"><code class="language-rust">use lambdaworks_plonk::constraint_system::ConstraintSystem;
use lambdaworks_math::elliptic_curve::short_weierstrass::curves::bls12_381::default_types::FrField;

fn main() {
    let system = &amp;mut ConstraintSystem::&lt;FrField&gt;::new();
    let x = system.new_public_input();
    let y = system.new_public_input();
    let e = system.new_variable();

    let z = pow(system, &amp;x, &amp;e);
    system.assert_eq(&amp;y, &amp;z);
}
</code></pre></pre>
<p>You can keep composing these functions in order to create more complex systems.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="../plonk/implementation.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="../starks/starks.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="../plonk/implementation.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="../starks/starks.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
